<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Installation &#8212; pwtools  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=3b47c8d5" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="Features" href="features.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo" />
    
    <h1 class="logo logo-name">pwtools</h1>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=elcorto&repo=pwtools&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../generated/api/index.html">API Reference</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#detailed-instructions">Detailed instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-tests">Running tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fortran-extensions-and-openmp-notes">Fortran extensions and OpenMP notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="background/index.html">Background, details, special topics</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">&lt;no title&gt;</a><ul>
      <li>Previous: <a href="features.html" title="previous chapter">Features</a></li>
      <li>Next: <a href="tutorial.html" title="next chapter">Tutorial</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h1>
<section id="quick-start">
<h2>Quick start<a class="headerlink" href="#quick-start" title="Link to this heading">¶</a></h2>
<p>Fortran compiler, Python headers, lapack, meson on Debian/Ubuntu:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>python3-dev<span class="w"> </span>gfortran<span class="w"> </span>liblapack-dev<span class="w"> </span>meson
</pre></div>
</div>
<p>Then</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;&lt;probably make a venv before, see below for examples&gt;&gt;</span>
$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/elcorto/pwtools
</pre></div>
</div>
<p>or</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/elcorto/pwtools
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>pwtools
$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="o">[</span>-e<span class="o">]</span><span class="w"> </span>.
</pre></div>
</div>
</section>
<section id="detailed-instructions">
<h2>Detailed instructions<a class="headerlink" href="#detailed-instructions" title="Link to this heading">¶</a></h2>
<p>To build the extension modules and install all Python dependencies via
<code class="docutils literal notranslate"><span class="pre">pip</span></code></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/elcorto/pwtools
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>pwtools
$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>or the editable mode (no copy of files), a.k.a. setuptools “develop mode”</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</pre></div>
</div>
<p>In both cases we build the extension modules (see <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>) via</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>src/_ext_src<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span><span class="nv">$PWTOOLS_EXT_MAKE_TARGET</span>
</pre></div>
</div>
<p>in the background, where <code class="docutils literal notranslate"><span class="pre">$PWTOOLS_EXT_MAKE_TARGET</span></code> is optional (more details
in the <a class="reference internal" href="#extensions"><span class="std std-ref">Fortran extensions and OpenMP notes</span></a> section).</p>
<p>If all dependencies are installed, e.g. by a package manager such as <code class="docutils literal notranslate"><span class="pre">apt</span></code>,
then recent <code class="docutils literal notranslate"><span class="pre">pip</span></code> versions should pick those up. Alternatively force <code class="docutils literal notranslate"><span class="pre">pip</span></code>
to install only the package without installing dependencies from pypi</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-deps<span class="w"> </span>.
</pre></div>
</div>
<p>When using a virtual environment, you can map in the system site-packages</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>--system-site-packages<span class="w"> </span>pwtools_venv
$<span class="w"> </span>./pwtools_venv/bin/activate
<span class="o">(</span>pwtools_venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>or using <a class="reference external" href="https://virtualenvwrapper.readthedocs.io">virtualenvwrapper</a></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mkvirtualenv<span class="w"> </span>--system-site-packages<span class="w"> </span>-p<span class="w"> </span>/usr/bin/python3<span class="w"> </span>pwtools_venv
<span class="o">(</span>pwtools_venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>Alternatively, you may also simply build the extensions and set <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>src/_ext_src<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make
$<span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PYTHONPATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">pp</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:<span class="nv">$PYTHONPATH</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">pp</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$pp</span>
</pre></div>
</div>
</section>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Link to this heading">¶</a></h2>
<p>Python dependencies: see <code class="docutils literal notranslate"><span class="pre">requirements*.txt</span></code>. You can use
<code class="docutils literal notranslate"><span class="pre">test/check_dependencies.py</span></code> to find out what your system has installed</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./test/check_dependencies.py
requirements_doc.txt
<span class="w">  </span>sphinx<span class="w">               </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>import<span class="o">)</span>
requirements.txt
<span class="w">  </span>PyCifRW<span class="w">              </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>pip<span class="w"> </span>list<span class="o">)</span>
<span class="w">  </span>h5py<span class="w">                 </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>import<span class="o">)</span>
<span class="w">  </span>matplotlib<span class="w">           </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>import<span class="o">)</span>
<span class="w">  </span>numpy<span class="w">                </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>import<span class="o">)</span>
<span class="w">  </span>scipy<span class="w">                </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>import<span class="o">)</span>
<span class="w">  </span>spglib<span class="w">               </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>import<span class="o">)</span>
requirements_test.txt
<span class="w">  </span>pytest<span class="w">               </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>import<span class="o">)</span>
<span class="w">  </span>pytest-xdist<span class="w">         </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>pip<span class="w"> </span>list<span class="o">)</span>
<span class="w">  </span>pytest-timeout<span class="w">       </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>import<span class="o">)</span>
requirements_optional.txt
<span class="w">  </span>ase<span class="w">                  </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>import<span class="o">)</span>
<span class="w">  </span>scikit-learn<span class="w">         </span>...<span class="w"> </span>ok<span class="w"> </span><span class="o">(</span>pip<span class="w"> </span>list<span class="o">)</span>
optional<span class="w"> </span>executables:
<span class="w">  </span>eos.x<span class="w">                </span>...<span class="w"> </span>NOT<span class="w"> </span>FOUND
</pre></div>
</div>
<p>Optional packages (<code class="docutils literal notranslate"><span class="pre">ase</span></code>, <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>) are only used in corner cases and are
therefore not hard dependencies. Importing modules that use them (e.g. <code class="docutils literal notranslate"><span class="pre">crys</span></code>
might use <code class="docutils literal notranslate"><span class="pre">ase</span></code>) won’t fail at import time, but later at runtime when e.g.
<code class="docutils literal notranslate"><span class="pre">crys.Structure.get_ase_atoms()</span></code> is called. What packages are optional might
change depending on usage.</p>
<p>Also note that you can get most Python packages via your system’s package
manager. Debian and derivatives:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python3-ase
python3-h5py
python3-matplotlib
python3-numpy
python3-pytest
python3-pytest-timeout
python3-pytest-xdist
python3-scipy
python3-sklearn
python3-sphinx
python3-spglib
python3-pycifrw
</pre></div>
</div>
<section id="optional-dependencies">
<h3>Optional dependencies<a class="headerlink" href="#optional-dependencies" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="http://www.ks.uiuc.edu/Research/vmd/">VMD</a> (<code class="docutils literal notranslate"><span class="pre">examples/rpdf/</span></code>, <a class="reference internal" href="../generated/api/pwtools.crys.call_vmd_measure_gofr.html#pwtools.crys.call_vmd_measure_gofr" title="pwtools.crys.call_vmd_measure_gofr"><code class="xref py py-func docutils literal notranslate"><span class="pre">call_vmd_measure_gofr()</span></code></a>,
<a class="reference internal" href="../generated/api/pwtools.visualize.view_vmd_axsf.html#pwtools.visualize.view_vmd_axsf" title="pwtools.visualize.view_vmd_axsf"><code class="xref py py-func docutils literal notranslate"><span class="pre">view_vmd_axsf()</span></code></a>,
<a class="reference internal" href="../generated/api/pwtools.visualize.view_vmd_xyz.html#pwtools.visualize.view_vmd_xyz" title="pwtools.visualize.view_vmd_xyz"><code class="xref py py-func docutils literal notranslate"><span class="pre">view_vmd_xyz()</span></code></a>), must register before download</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">fourier.x</span></code> tool from the <a class="reference external" href="http://www.cpmd.org">CPMD</a> contrib sources (for
<code class="docutils literal notranslate"><span class="pre">examples/</span></code>). Need to register before download.</p></li>
<li><p>eos (for <a class="reference internal" href="../generated/api/__sphinx_autodoc_module__pwtools.eos.html#module-pwtools.eos" title="pwtools.eos"><code class="xref py py-mod docutils literal notranslate"><span class="pre">eos</span></code></a>): The tool “eos” from the <a class="reference external" href="http://elk.sourceforge.net">Elk</a> code must
be on your path. Note that the executable is assumed to be named <code class="docutils literal notranslate"><span class="pre">eos.x</span></code>
instead of the default name “eos”. See <a class="reference internal" href="../generated/api/pwtools.eos.ElkEOSFit.html#pwtools.eos.ElkEOSFit" title="pwtools.eos.ElkEOSFit"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElkEOSFit</span></code></a> for
usage.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../generated/api/pwtools.eos.ElkEOSFit.html#pwtools.eos.ElkEOSFit" title="pwtools.eos.ElkEOSFit"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElkEOSFit</span></code></a> is deprecated, you don’t
really need the Elk code’s eos tool anymore. It was used to generate
reference EOS fit data for unit tests, which is stored in test/files/, but
there is no use of eos.x in pwtools anymore.</p>
</div>
</section>
</section>
<section id="running-tests">
<h2>Running tests<a class="headerlink" href="#running-tests" title="Link to this heading">¶</a></h2>
<p>See test/README. Actually, all of these are good examples, too!</p>
</section>
<section id="fortran-extensions-and-openmp-notes">
<span id="extensions"></span><h2>Fortran extensions and OpenMP notes<a class="headerlink" href="#fortran-extensions-and-openmp-notes" title="Link to this heading">¶</a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">src/_ext_src/Makefile</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>make<span class="w"> </span><span class="nb">help</span>
make<span class="w"> </span>gfortran<span class="w">            </span><span class="c1"># gfortran, default</span>
make<span class="w"> </span>gfortran-omp<span class="w">        </span><span class="c1"># gfortran + OpenMP</span>
make<span class="w"> </span>gfortran-mkl<span class="w">        </span><span class="c1"># gfortran, Intel MKL lapack, set MKL_LIB</span>
make<span class="w"> </span>ifort<span class="w">               </span><span class="c1"># ifort</span>
make<span class="w"> </span>ifort-omp<span class="w">           </span><span class="c1"># ifort + OpenMP</span>
make<span class="w"> </span>ifort-mkl<span class="w">           </span><span class="c1"># ifort, Intel MKL lapack, set MKL_LIB</span>
</pre></div>
</div>
<p>Generates <code class="docutils literal notranslate"><span class="pre">*.so</span></code> files</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>src/_ext_src/_dcd.so<span class="w">     </span><span class="c1"># will be copied to src/pwtools/_dcd.so</span>
src/_ext_src/_flib.so<span class="w">    </span><span class="c1"># will be copied to src/pwtools/_flib.so</span>
</pre></div>
</div>
<p>You need the following to compile extensions. On Debian/Ubuntu</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># apt</span>
python3-numpy<span class="w">       </span><span class="c1"># for f2py</span>
python3-dev<span class="w">         </span><span class="c1"># Python headers</span>
gfortran<span class="w">            </span><span class="c1"># or ifort, see src/_ext_src/Makefile</span>
liblapack-dev<span class="w">       </span><span class="c1"># see below</span>
meson<span class="w">               </span><span class="c1"># f2py build backend as of Python 3.12, will also install ninja</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">liblapack-dev</span></code> is only one option, maybe the slowest. On Debian/Ubuntu,
there are other options, i.e. anything that provides a <code class="docutils literal notranslate"><span class="pre">liblapack.so</span></code> works.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>apt-file<span class="w"> </span>search<span class="w"> </span>-x<span class="w"> </span><span class="s1">&#39;liblapack.so$&#39;</span>
libatlas-base-dev:<span class="w"> </span>/usr/lib/x86_64-linux-gnu/atlas/liblapack.so
liblapack-dev:<span class="w"> </span>/usr/lib/x86_64-linux-gnu/lapack/liblapack.so
libmkl-dev:<span class="w"> </span>/usr/lib/x86_64-linux-gnu/mkl/liblapack.so
libopenblas-openmp-dev:<span class="w"> </span>/usr/lib/x86_64-linux-gnu/openblas-openmp/liblapack.so
libopenblas-pthread-dev:<span class="w"> </span>/usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so
libopenblas-serial-dev:<span class="w"> </span>/usr/lib/x86_64-linux-gnu/openblas-serial/liblapack.so
</pre></div>
</div>
<p>The default <code class="docutils literal notranslate"><span class="pre">make</span></code> target is “gfortran” which tries to build a serial version
using system LAPACK (e.g. from <code class="docutils literal notranslate"><span class="pre">liblapack-dev</span></code>). If you want another
target (e.g. <code class="docutils literal notranslate"><span class="pre">ifort-mkl</span></code>), then</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>src/_ext_src
$<span class="w"> </span>make<span class="w"> </span>clean
$<span class="w"> </span>make<span class="w"> </span>ifort-mkl
</pre></div>
</div>
</div></blockquote>
<p>or when using <code class="docutils literal notranslate"><span class="pre">pip</span></code> (or anything calling <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>) set
<code class="docutils literal notranslate"><span class="pre">$PWTOOLS_EXT_MAKE_TARGET</span></code>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nv">PWTOOLS_EXT_MAKE_TARGET</span><span class="o">=</span>ifort-mkl<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>...
</pre></div>
</div>
<p>This will use the Intel <code class="docutils literal notranslate"><span class="pre">ifort</span></code> compiler instead of the default <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> and
link against the MKL.</p>
<p>In the MKL case, the Makefile uses the env var <code class="docutils literal notranslate"><span class="pre">$MKL_LIB</span></code> which should point
to the location where things like <code class="docutils literal notranslate"><span class="pre">libmkl_core.so</span></code> live. You may need to set
this. On a HPC cluster, that could look like this.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># module only sets MKL_ROOT=/path/to/intel/20.4/mkl</span>
$<span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>intel/20.4
$<span class="w"> </span><span class="nv">MKL_LIB</span><span class="o">=</span><span class="nv">$MKL_ROOT</span>/lib/intel64<span class="w"> </span><span class="nv">PWTOOLS_EXT_MAKE_TARGET</span><span class="o">=</span>ifort-mkl<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>...
</pre></div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">src/_ext_src/Makefile</span></code> for more details.</p>
<section id="openmp">
<h3>OpenMP<a class="headerlink" href="#openmp" title="Link to this heading">¶</a></h3>
<p>We managed to speed up the calculations by sprinkling some OpenMP
pragmas in <code class="docutils literal notranslate"><span class="pre">*.f90</span></code>. Use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ifort-omp</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">gfortran-omp</span></code> in that
case.</p>
<p>If all went well, <code class="docutils literal notranslate"><span class="pre">_flib.so</span></code> should be linked to <code class="docutils literal notranslate"><span class="pre">libgomp</span></code> (or <code class="docutils literal notranslate"><span class="pre">libiomp</span></code>
for <code class="docutils literal notranslate"><span class="pre">ifort</span></code>). Check with:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ldd<span class="w"> </span>_flib.so
</pre></div>
</div>
<p>Setting the number of threads:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">2</span>
$<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import numpy as np; from pwtools.pydos import fvacf; \</span>
<span class="s2">             fvacf(np.random.rand(5000,1000,3))&quot;</span>
</pre></div>
</div>
<p>If this env var is NOT set, then OpenMP uses all available cores (e.g. 4 on a
quad-core box).</p>
<p>There is also an optional arg ‘nthreads’ to <code class="docutils literal notranslate"><span class="pre">_flib.vacf()</span></code>. If this is
supplied, then it will override <code class="docutils literal notranslate"><span class="pre">OMP_NUM_THREADS</span></code>.</p>
</section>
<section id="tests">
<h3>Tests<a class="headerlink" href="#tests" title="Link to this heading">¶</a></h3>
<p>When developing OpenMP code, you may find that code doesn’t produce correct
results, even if it runs, if OpenMP is used incorrectly :) The test script
<code class="docutils literal notranslate"><span class="pre">test/runtests.sh</span></code> calls <cite>make gfortran-omp</cite>, so if code is broken by OpenMP,
all test using the Fortran extensions might fail. To run tests with other
builds, use one of</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>make<span class="w"> </span>gfortran
$<span class="w"> </span>make<span class="w"> </span>ifort
$<span class="w"> </span>make<span class="w"> </span>ifort-omp
</pre></div>
</div>
<p>and</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nb">test</span>
$<span class="w"> </span>./runtests.sh<span class="w"> </span>--nobuild
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;Steve Schmerler.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/written/install.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>